<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>One Day One Juz Tracker</title>
    <style>
        /* Reset dan Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', sans-serif;
            background: linear-gradient(135deg, #FFEEA9 0%, #FFBF78 25%, #FF7D29 75%, #7B4019 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            padding: 30px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .main-title {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, #7B4019, #FF7D29, #FFBF78);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.1rem;
        }

        /* Navigation Tabs */
        .nav-container {
            display: flex;
            justify-content: center;
            margin-bottom: 40px;
        }

        .nav-tabs {
            background: rgba(255, 255, 255, 0.9);
            padding: 8px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 5px;
        }

        .nav-tab {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            background: transparent;
            color: #666;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #FF7D29, #FFBF78);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 125, 41, 0.4);
            transform: translateY(-2px);
        }

        .nav-tab:hover:not(.active) {
            color: #FF7D29;
            background: rgba(255, 125, 41, 0.1);
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Firebase Status */
        .firebase-status {
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 25px;
            font-weight: 600;
            text-align: center;
            background: linear-gradient(135deg, #F59E0B, #FBBF24);
            color: white;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            padding: 25px;
            border-radius: 15px;
            background: white;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(255, 125, 41, 0.1);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.12);
        }

        .stat-card.orange {
            background: linear-gradient(135deg, #FFF7ED, #FFEDD5);
            border-color: #FDBA74;
        }

        .stat-card.amber {
            background: linear-gradient(135deg, #FFFBEB, #FEF3C7);
            border-color: #FDE68A;
        }

        .stat-card.yellow {
            background: linear-gradient(135deg, #FEFCE8, #FEF9C3);
            border-color: #FEF08A;
        }

        .stat-content {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .stat-icon {
            color: #FF7D29;
            font-size: 24px;
        }

        .stat-text {
            color: #7B4019;
            font-weight: 600;
            font-size: 1.1rem;
        }

        /* Daily Info */
        .daily-info {
            margin-bottom: 30px;
        }

        .info-card {
            background: linear-gradient(135deg, #EBF8FF, #DBEAFE);
            border: 1px solid #93C5FD;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.1);
        }

        .info-card h4 {
            color: #1E40AF;
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .info-card p {
            color: #1E3A8A;
            font-size: 0.9rem;
            margin: 5px 0;
            font-weight: 500;
        }

        /* Participants Grid - Enhanced */
        .participants-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .participant-card {
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #E5E7EB;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .participant-card:hover {
            border-color: #FF7D29;
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(255, 125, 41, 0.2);
        }

        .participant-card.completed {
            background: linear-gradient(135deg, #ECFDF5, #D1FAE5);
            border-color: #34D399;
        }

        .participant-content {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
        }

        .participant-info {
            flex: 1;
            margin-right: 15px;
        }

        .participant-info h3 {
            font-weight: 600;
            color: #1F2937;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .participant-info p {
            color: #6B7280;
            font-size: 0.9rem;
            margin-bottom: 4px;
        }

        .participant-info small {
            font-weight: 600;
        }

        .participant-actions {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }

        .icon {
            transition: all 0.3s ease;
        }

        .icon-completed {
            color: #10B981;
        }

        .icon-pending {
            color: #D1D5DB;
        }

        /* Monthly Tab */
        .month-selector {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .month-selector label {
            color: #374151;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .month-selector select {
            padding: 12px 16px;
            border: 2px solid #E5E7EB;
            border-radius: 10px;
            background: white;
            color: #374151;
            font-weight: 500;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 200px;
        }

        .month-selector select:focus {
            outline: none;
            border-color: #FF7D29;
            box-shadow: 0 0 0 3px rgba(255, 125, 41, 0.1);
        }

        /* Monthly Stats */
        .monthly-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .monthly-stat-card {
            padding: 30px;
            border-radius: 15px;
            background: white;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(255, 125, 41, 0.1);
            transition: all 0.3s ease;
        }

        .monthly-stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.12);
        }

        .monthly-stat-card.orange {
            background: linear-gradient(135deg, #FFF7ED, #FFEDD5);
        }

        .monthly-stat-card.amber {
            background: linear-gradient(135deg, #FFFBEB, #FEF3C7);
        }

        .monthly-stat-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .monthly-stat-header h3 {
            color: #7B4019;
            font-weight: 700;
            font-size: 1.2rem;
        }

        .monthly-stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: #FF7D29;
        }

        /* Progress Section */
        .progress-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(255, 125, 41, 0.1);
        }

        .progress-section h3 {
            color: #1F2937;
            font-weight: 700;
            font-size: 1.3rem;
            margin-bottom: 25px;
        }

        .progress-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .progress-item {
            padding: 20px;
            background: #F9FAFB;
            border-radius: 12px;
            border: 1px solid #E5E7EB;
            transition: all 0.3s ease;
        }

        .progress-item:hover {
            background: #F3F4F6;
            border-color: #D1D5DB;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .progress-name {
            font-weight: 600;
            color: #374151;
            font-size: 0.95rem;
        }

        .progress-count {
            color: #6B7280;
            font-size: 0.9rem;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #E5E7EB;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF7D29, #FFBF78);
            border-radius: 4px;
            transition: width 0.6s ease;
        }

        .progress-percentage {
            color: #6B7280;
            font-size: 0.8rem;
            text-align: right;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-title {
                font-size: 2rem;
            }
            
            .app-container {
                padding: 20px;
                margin: 10px;
            }
            
            .nav-tabs {
                flex-direction: column;
                width: 100%;
            }
            
            .nav-tab {
                width: 100%;
                text-align: center;
            }
        }

        /* Icons */
        .icon {
            width: 24px;
            height: 24px;
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <h1 class="main-title">One Day One Juz Ibnu Katsir</h1>
            <p class="subtitle">Memantau progress membaca Al-Qur'an bersama</p>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-container">
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="switchTab('daily')">Harian</button>
                <button class="nav-tab" onclick="switchTab('monthly')">Rekap Bulanan</button>
            </div>
        </div>

        <!-- Daily Tab -->
        <div id="daily-tab" class="tab-content active">
            <!-- Firebase Status -->
            <div class="firebase-status" id="firebase-status">
                <span id="firebase-status-text">Status: üü° Checking Firebase...</span>
                <div id="firebase-actions" style="margin-top: 10px; display: none;">
                    <button onclick="testFirebaseConnection()" style="
                        background: rgba(255,255,255,0.2);
                        color: white;
                        border: none;
                        padding: 5px 10px;
                        border-radius: 5px;
                        cursor: pointer;
                    ">üîÑ Test Connection</button>
                </div>
            </div>

            <!-- Header Stats -->
            <div class="stats-grid">
                <div class="stat-card orange">
                    <div class="stat-content">
                        <span class="stat-icon">üìÖ</span>
                        <span class="stat-text" id="current-date">Loading...</span>
                    </div>
                </div>
                
                <div class="stat-card amber">
                    <div class="stat-content">
                        <span class="stat-icon">üë•</span>
                        <span class="stat-text"><span id="completed-today">0</span>/30 Selesai Hari Ini</span>
                    </div>
                </div>
                
                <div class="stat-card yellow">
                    <div class="stat-content">
                        <span class="stat-icon">üèÜ</span>
                        <span class="stat-text" id="khatam-status">30 Lagi untuk Khatam</span>
                    </div>
                </div>
            </div>

            <!-- Daily Info -->
            <div class="daily-info">
                <div class="info-card">
                    <h4>Ya Allah, turunkan rahmat kepada kami dengan wasilah bacaan Al-Quran</h4>
                    <p>Jadikan kami lebih mencintai untuk berinteraksi dengan Al Qur'an daripada berbuat sia-sia</p>
                    <p>Anugerahkan kami pemahaman Al Qur'an dan pengamalannya</p>
                    <p>Perkenankan Al-Qur'an memberi syafaat untuk kami</p>
                </div>
            </div>

            <!-- Participants Grid -->
            <div class="participants-grid" id="participants-grid">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>

        <!-- Monthly Tab -->
        <div id="monthly-tab" class="tab-content">
            <!-- Month Selector -->
            <div class="month-selector">
                <label>Pilih Bulan:</label>
                <select id="month-selector" onchange="updateMonthlyView()">
                    <!-- Will be populated by JavaScript -->
                </select>
            </div>

            <!-- Monthly Stats -->
            <div class="monthly-stats">
                <div class="monthly-stat-card orange">
                    <div class="monthly-stat-header">
                        <span class="stat-icon">üèÜ</span>
                        <h3>Khatam Bulan Ini</h3>
                    </div>
                    <div class="monthly-stat-value" id="monthly-khatam">0x</div>
                </div>
                
                <div class="monthly-stat-card amber">
                    <div class="monthly-stat-header">
                        <span class="stat-icon">üìä</span>
                        <h3>Total Partisipasi</h3>
                    </div>
                    <div class="monthly-stat-value" id="monthly-participation">0</div>
                </div>
            </div>

            <!-- Progress Section -->
            <div class="progress-section">
                <h3>Progress Peserta</h3>
                <div class="progress-grid" id="progress-grid">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, doc, setDoc, collection, getDocs, onSnapshot, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        // Make Firebase functions available globally
        window.firebaseModules = {
            initializeApp,
            getFirestore,
            doc,
            setDoc,
            collection,
            getDocs,
            onSnapshot,
            query,
            orderBy
        };
        
        // Initialize the app after Firebase modules are loaded
        window.initAppAfterFirebase();
    </script>

    <script>
        // Application Data - NAMA PESERTA YANG SUDAH DIPERBAIKI
        const participantNames = [
            'Syafiq',      // Peserta 1
            'Siti',        // Peserta 2  
            'Muhammad',    // Peserta 3
            'Fatimah',     // Peserta 4
            'Abdul',       // Peserta 5
            'Khadijah',    // Peserta 6
            'Umar',        // Peserta 7
            'Maryam',      // Peserta 8
            'Ali',         // Peserta 9
            'Said',        // Peserta 10
            'Yusuf',       // Peserta 11
            'Zainab',      // Peserta 12
            'Hamza',       // Peserta 13
            'Aminah',      // Peserta 14
            'Khalid',      // Peserta 15
            'Hafsa',       // Peserta 16
            'Bilal',       // Peserta 17
            'Nur',         // Peserta 18
            'Salman',      // Peserta 19
            'Ummu',        // Peserta 20
            'Zaid',        // Peserta 21
            'Asma',        // Peserta 22
            'Talhah',      // Peserta 23
            'Habibah',     // Peserta 24
            'Sadil',       // Peserta 25
            'Saris',       // Peserta 26
            'Abdullah',    // Peserta 27
            'Juwed',       // Peserta 28
            'Anas',        // Peserta 29
            'Umming'       // Peserta 30
        ];

        // Detail Juz dan Ayat - DETAIL BACAAN SETIAP JUZ
        const juzDetails = {
            1: { 
                surah: "Al-Fatihah:1 - Al-Baqarah:141", 
                pages: "1-21",
                description: ""
            },
            2: { 
                surah: "Al-Baqarah:142 - 253", 
                pages: "22-41",
                description: "Tambah baca sampai ayat 253 untuk selesaikan tema"
            },
            3: { 
                surah: "Al-Baqarah:254 - Ali Imran:92", 
                pages: "42-62",
                description: "Tadabburi awal ayat juz 4, jangan lupa sedekah :)"
            },
            4: { 
                surah: "Ali Imran:93 - An-Nisa:22", 
                pages: "61-82",
                description: "Cukup baca sampai ayat 22 agar tidak memotong tema"
            },
            5: { 
                surah: "An-Nisa : 23-147", 
                pages: "81-102",
                description: "Baca dari ayat 23, bukan dari ayat 24"
            },
            6: { 
                surah: "An-Nisa:148 - Al-Maidah:81", 
                pages: "101-121",
                description: "Cukup sampai ayat 81 agar tidak memotong tema"
            },
            7: { 
                surah: "Al-Maidah:82 - Al-An'am:107", 
                pages: "121-141",
                description: "Baca dari ayat 82, berhenti di ayat 107 surat Al An'am"
            },
            8: { 
                surah: "Al-An'am:108 - Al-A'raf:84", 
                pages: "141-161",
                description: "Baca dari ayat 108, berhenti di ayat 84 Al A'raf agar tak memotong tema"
            },
            9: { 
                surah: "Al-A'raf:85 - Al-Anfal:40", 
                pages: "162-181",
                description: "Al-A'raf 85-206 + Al-Anfal 1-40"
            },
            10: { 
                surah: "Al-Anfal:41 - At-Taubah:89", 
                pages: "182-201",
                description: "Cukup baca sampai ayat 89 At Taubah agar tidak memotong tema"
            },
            11: { 
                surah: "At-Taubah:90 - Akhir surat Yunus", 
                pages: "201-221",
                description: "At-Taubah 93-129 + Yunus"
            },
            12: { 
                surah: "Hud ayat 1 - Yusuf:57", 
                pages: "221-242",
                description: "Tambah baca sampai ayat 57, menyesuaikan tema"
            },
            13: { 
                surah: "Yusuf:57 - Ibrahim:52", 
                pages: "243-261",
                description: ""
            },
            14: { 
                surah: "Al-Hijr - An-Nahl", 
                pages: "262-281",
                description: ""
            },
            15: { 
                surah: "Al-Isra ayat 1 - Al-Kahf 18:82", 
                pages: "281-303",
                description: "baca sampai ayat 82, syukur2 kalau mau baca sampai habis"
            },
            16: { 
                surah: "Al-Kahf:83 - Taha", 
                pages: "302-322",
                description: "Al Qur'an gak akan nyusahin, cek awal surat Thoha ^^"
            },
            17: { 
                surah: "Al-Anbiya - Al-Hajj", 
                pages: "322-341",
                description: "Semoga Allah mudahkan kita berangkat Haji dan Umroh"
            },
            18: { 
                surah: "Al-Mu'minun ayat 1 - Al-Furqan:20", 
                pages: "342-361",
                description: "Al-Mu'minun + An-Nur + Al-Furqan 1-20"
            },
            19: { 
                surah: "Al-Furqan:21 - An-Naml:58", 
                pages: "362-381",
                description: "Tambah baca sampai ayat 58"
            },
            20: { 
                surah: "An-Naml:59 - Al-Ankabut:45", 
                pages: "382-401",
                description: "Mulai dari ayat 59 An Naml"
            },
            21: { 
                surah: "Al-Ankabut:46 - Al-Ahzab:34", 
                pages: "402-421",
                description: "Tambah baca sampai ayat 34"
            },
            22: { 
                surah: "Al-Ahzab:35 - Terakhir", 
                pages: "422-440",
                description: "Mulai baca dari ayat 35 sampai akhir Al Ahzab, Yasin dibaca besok hehe"
            },
            23: { 
                surah: "Ya Sin ayat 1 - Az-Zumar:31", 
                pages: "440-462",
                description: ""
            },
            24: { 
                surah: "Az-Zumar:32 - Fussilat ayat terakhir", 
                pages: "461-483",
                description: "Selesaikan surat Fushshilat, nanggung :)"
            },
            25: { 
                surah: "Asy Syura ayat 1 - Al-Jatsiyah", 
                pages: "483-501",
                description: "Fussilat 47-54 + Asy-Syura + Az-Zukhruf + Ad-Dukhan + Al-Jatsiyah"
            },
            26: { 
                surah: "Al-Ahqaf - Surat Qaf", 
                pages: "502-520",
                description: "Selesaikan saja di akhir surat Qaf, nambah juga boleh"
            },
            27: { 
                surah: "Adz Dzariyat - Al-Hadid", 
                pages: "520-541",
                description: "Juz paling seru versi admin"
            },
            28: { 
                surah: "Al-Mujadilah - At-Tahrim", 
                pages: "542-561",
                description: ""
            },
            29: { 
                surah: "Al-Mulk - Al-Mursalat", 
                pages: "563-582",
                description: ""
            },
            30: { 
                surah: "An-Naba - An-Nas", 
                pages: "583-604",
                description: "Alhamdulillah khatam, jangan lupa langsung lanjut baca Al Fatihah + 5 ayat Al Baqarah"
            }
        };
        
        let participants = [];
        let monthlyRecords = {};
        let currentDate = new Date();
        let db = null;
        let isFirebaseConnected = false;
        let firebaseApp = null;
        let unsubscribeListeners = [];
        let lastResetCheck = null;
        let midnightResetTimeout = null;
        let baseStartDate = new Date('2025-07-01'); // Tanggal mulai program

        // Wait for Firebase modules to load
        window.initAppAfterFirebase = function() {
            // Firebase config untuk project ibkangaji
            const firebaseConfig = {
                apiKey: "AIzaSyB2GeZEZ2m2Qwq4nEzmeLlIrhN61DQusvg",
                authDomain: "ibkangaji.firebaseapp.com",
                projectId: "ibkangaji",
                storageBucket: "ibkangaji.firebasestorage.app",
                messagingSenderId: "401662109480",
                appId: "1:401662109480:web:768935620ffc698cd8521d"
            };
            
            // Auto-connect to Firebase
            connectToFirebase(firebaseConfig);
            hideFirebaseConfig();
            
            initApp();
        };

        // Firebase configuration functions
        function showFirebaseConfig() {
            document.getElementById('firebase-config-modal').style.display = 'flex';
        }

        function hideFirebaseConfig() {
            // Modal sudah dihapus, tidak perlu fungsi ini lagi
        }

        function initializeFirebase() {
            // Fungsi ini tidak diperlukan lagi karena config sudah hardcoded
        }

        function skipFirebase() {
            // Fungsi ini tidak diperlukan lagi karena config sudah hardcoded
        }

        function connectToFirebase(config) {
            try {
                // Initialize Firebase
                firebaseApp = window.firebaseModules.initializeApp(config);
                db = window.firebaseModules.getFirestore(firebaseApp);
                isFirebaseConnected = true;
                
                updateFirebaseStatus('connected', 'üü¢ CENTANG SESUAI NAMA | Project: ibkangaji');
                
                // Setup real-time listeners
                setupFirebaseListeners();
                
                // Load data from Firebase
                loadFromFirebase();
                
                console.log('‚úÖ Firebase connected successfully to project: ibkangaji');
                
            } catch (error) {
                console.error('‚ùå Firebase connection failed:', error);
                updateFirebaseStatus('error', 'üî¥ Firebase Error - Menggunakan mode offline');
                isFirebaseConnected = false;
                
                // Fallback to localStorage
                loadFromLocalStorage();
            }
        }

        function updateFirebaseStatus(status, message) {
            const statusElement = document.getElementById('firebase-status');
            const statusTextElement = document.getElementById('firebase-status-text');
            const actionsElement = document.getElementById('firebase-actions');
            
            statusTextElement.textContent = message;
            
            // Update styling based on status
            switch(status) {
                case 'connected':
                    statusElement.style.background = 'linear-gradient(135deg, #10B981, #34D399)';
                    actionsElement.style.display = 'none';
                    break;
                case 'offline':
                    statusElement.style.background = 'linear-gradient(135deg, #F59E0B, #FBBF24)';
                    actionsElement.style.display = 'block';
                    break;
                case 'error':
                    statusElement.style.background = 'linear-gradient(135deg, #EF4444, #F87171)';
                    actionsElement.style.display = 'block';
                    break;
            }
        }

        function testFirebaseConnection() {
            if (isFirebaseConnected) {
                alert('‚úÖ Firebase sudah terhubung dengan baik!\n\nProject: ibkangaji\nStatus: Real-time sync aktif');
            } else {
                alert('‚ùå Firebase tidak terhubung.\n\nMenggunakan mode offline.\nData tersimpan di browser lokal saja.');
            }
        }

        // Firebase data functions
        function setupFirebaseListeners() {
            if (!isFirebaseConnected || !db) return;

            try {
                // Listen to participants collection
                const participantsQuery = window.firebaseModules.query(
                    window.firebaseModules.collection(db, 'participants'),
                    window.firebaseModules.orderBy('id')
                );
                
                const unsubscribeParticipants = window.firebaseModules.onSnapshot(participantsQuery, (snapshot) => {
                    const firebaseParticipants = [];
                    snapshot.forEach((doc) => {
                        firebaseParticipants.push(doc.data());
                    });
                    
                    // Only update if we have data from Firebase, and don't replace initialized data unnecessarily
                    if (firebaseParticipants.length === 30) {
                        participants = firebaseParticipants;
                        // Pastikan juz update setelah load
                        updateAllParticipantsJuz();
                        renderDailyTab();
                        console.log('üì° Real-time update: participants loaded from Firebase');
                    } else if (firebaseParticipants.length > 0) {
                        // Partial data - merge with existing participants
                        firebaseParticipants.forEach(fbParticipant => {
                            const existingIndex = participants.findIndex(p => p.id === fbParticipant.id);
                            if (existingIndex !== -1) {
                                participants[existingIndex] = fbParticipant;
                            }
                        });
                        updateAllParticipantsJuz();
                        renderDailyTab();
                        console.log(`üì° Partial update: ${firebaseParticipants.length} participants updated from Firebase`);
                    }
                }, (error) => {
                    console.error('‚ùå Error listening to participants:', error);
                });

                // Listen to monthly records
                const monthlyQuery = window.firebaseModules.collection(db, 'monthlyRecords');
                const unsubscribeMonthly = window.firebaseModules.onSnapshot(monthlyQuery, (snapshot) => {
                    const firebaseRecords = {};
                    snapshot.forEach((doc) => {
                        firebaseRecords[doc.id] = doc.data();
                    });
                    
                    monthlyRecords = { ...monthlyRecords, ...firebaseRecords };
                    console.log('üì° Real-time update: monthly records loaded from Firebase');
                }, (error) => {
                    console.error('‚ùå Error listening to monthly records:', error);
                });

                unsubscribeListeners.push(unsubscribeParticipants, unsubscribeMonthly);
                
            } catch (error) {
                console.error('‚ùå Error setting up Firebase listeners:', error);
            }
        }

        async function saveParticipantToFirebase(participant) {
            if (!isFirebaseConnected || !db) {
                console.log('üì± Firebase not connected, saving locally only');
                return;
            }

            try {
                await window.firebaseModules.setDoc(
                    window.firebaseModules.doc(db, 'participants', participant.id.toString()),
                    participant
                );
                console.log(`‚úÖ Participant ${participant.id} saved to Firebase`);
            } catch (error) {
                console.error('‚ùå Error saving participant to Firebase:', error);
            }
        }

        async function saveMonthlyRecordToFirebase(monthKey, record) {
            if (!isFirebaseConnected || !db) return;

            try {
                await window.firebaseModules.setDoc(
                    window.firebaseModules.doc(db, 'monthlyRecords', monthKey),
                    record
                );
                console.log(`‚úÖ Monthly record ${monthKey} saved to Firebase`);
            } catch (error) {
                console.error('‚ùå Error saving monthly record to Firebase:', error);
            }
        }

        async function loadFromFirebase() {
            if (!isFirebaseConnected || !db) return;

            try {
                // Load participants
                const participantsSnapshot = await window.firebaseModules.getDocs(
                    window.firebaseModules.collection(db, 'participants')
                );
                
                if (!participantsSnapshot.empty) {
                    const firebaseParticipants = [];
                    participantsSnapshot.forEach((doc) => {
                        firebaseParticipants.push(doc.data());
                    });
                    
                    // Sort by ID
                    firebaseParticipants.sort((a, b) => a.id - b.id);
                    
                    if (firebaseParticipants.length === 30) {
                        participants = firebaseParticipants;
                        // PERBAIKAN: Paksa update nama dengan nama yang benar
                        participants.forEach((participant, index) => {
                            if (participantNames[index]) {
                                participant.name = participantNames[index];
                            }
                        });
                        console.log('üì• All 30 participants loaded from Firebase and names updated');
                    } else {
                        // If partial data, merge with initialized participants
                        console.log(`üì• ${firebaseParticipants.length} participants found in Firebase, initializing rest`);
                        firebaseParticipants.forEach(fbParticipant => {
                            const existingIndex = participants.findIndex(p => p.id === fbParticipant.id);
                            if (existingIndex !== -1) {
                                participants[existingIndex] = fbParticipant;
                                // PERBAIKAN: Paksa update nama
                                if (participantNames[existingIndex]) {
                                    participants[existingIndex].name = participantNames[existingIndex];
                                }
                            }
                        });
                        
                        // Save missing participants to Firebase
                        participants.forEach(participant => {
                            const exists = firebaseParticipants.find(fp => fp.id === participant.id);
                            if (!exists) {
                                saveParticipantToFirebase(participant);
                            }
                        });
                    }
                } else {
                    // No participants in Firebase, save initialized participants
                    console.log('üì• No participants in Firebase, saving initialized data');
                    participants.forEach(participant => {
                        saveParticipantToFirebase(participant);
                    });
                }

                // Update juz setelah load data
                updateAllParticipantsJuz();

                // Load monthly records
                const monthlySnapshot = await window.firebaseModules.getDocs(
                    window.firebaseModules.collection(db, 'monthlyRecords')
                );
                
                const firebaseRecords = {};
                monthlySnapshot.forEach((doc) => {
                    firebaseRecords[doc.id] = doc.data();
                });
                
                if (Object.keys(firebaseRecords).length > 0) {
                    monthlyRecords = { ...monthlyRecords, ...firebaseRecords };
                    console.log('üì• Monthly records loaded from Firebase');
                }

                // PERBAIKAN: Paksa save nama yang sudah diperbaiki ke Firebase
                participants.forEach(participant => {
                    saveParticipantToFirebase(participant);
                });

                renderDailyTab();
                
            } catch (error) {
                console.error('‚ùå Error loading from Firebase:', error);
            }
        }

        // Initialize app
        function initApp() {
            initializeParticipants();
            updateCurrentDate();
            setupDailyReset();
            populateMonthSelector();
            renderDailyTab();
            
            // Load from localStorage if no Firebase data
            if (!isFirebaseConnected) {
                loadFromLocalStorage();
            }
            
            console.log('‚úÖ App initialized');
            console.log(`üìÖ Current date: ${currentDate.toLocaleString('id-ID')}`);
            console.log(`üìã Participants initialized: ${participants.length}`);
        }

        // PERBAIKAN: Initialize participants dengan nama yang benar
        function initializeParticipants() {
            console.log('üîß Initializing participants...');
            console.log('üìù Available names:', participantNames);
            
            participants = Array.from({ length: 30 }, (_, i) => {
                const participantName = participantNames[i] || `Peserta ${i + 1}`;
                console.log(`Creating participant ${i + 1}: ${participantName}`);
                
                return {
                    id: i + 1,
                    name: participantName,
                    dailyProgress: {},
                    currentJuz: 1, // Set default dulu
                    lastUpdated: currentDate.toISOString().split('T')[0]
                };
            });
            
            // Update juz berdasarkan tanggal saat ini
            updateAllParticipantsJuz();
            
            // Verify initialization
            console.log('‚úÖ Participants initialized:');
            participants.forEach((p, i) => {
                console.log(`${i + 1}. ID: ${p.id}, Name: ${p.name}, Juz: ${p.currentJuz}`);
            });
        }

        // PERBAIKAN: Fungsi untuk menghitung juz berdasarkan hari dari tanggal mulai
        function calculateJuzForParticipant(participantId, currentDate) {
            // Hitung hari sejak tanggal mulai program
            const diffTime = currentDate - baseStartDate;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            // Formula rotasi: (participant_id - 1 + days_passed) % 30 + 1
            const juz = ((participantId - 1 + diffDays) % 30) + 1;
            
            console.log(`üìñ Participant ${participantId}: Day ${diffDays} from start ‚Üí Juz ${juz}`);
            return juz;
        }

        // PERBAIKAN: Update juz untuk semua participant
        function updateAllParticipantsJuz() {
            participants.forEach(participant => {
                participant.currentJuz = calculateJuzForParticipant(participant.id, currentDate);
            });
            console.log('üîÑ Updated juz for all participants based on current date');
        }

        // Update current date display
        function updateCurrentDate() {
            const dateStr = currentDate.toLocaleDateString('id-ID', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('current-date').textContent = dateStr;
        }

        // Setup daily reset
        function setupDailyReset() {
            lastResetCheck = getTodayKey();
            scheduleNextMidnightReset();
            
            // Backup check every minute
            setInterval(() => {
                const now = new Date();
                const today = now.toISOString().split('T')[0];
                
                if (lastResetCheck && lastResetCheck !== today) {
                    console.log('üîÑ Date changed detected via backup check, performing reset');
                    performDailyReset();
                }
                
                lastResetCheck = today;
            }, 60000);
        }

        function scheduleNextMidnightReset() {
            if (midnightResetTimeout) {
                clearTimeout(midnightResetTimeout);
            }
            
            const now = new Date();
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(0, 0, 0, 0);
            
            const timeUntilMidnight = tomorrow.getTime() - now.getTime();
            
            console.log(`‚è∞ Current time: ${now.toLocaleString('id-ID')}`);
            console.log(`‚è∞ Next reset scheduled for: ${tomorrow.toLocaleString('id-ID')}`);
            console.log(`‚è∞ Time until reset: ${Math.round(timeUntilMidnight / 1000 / 60)} minutes`);
            
            midnightResetTimeout = setTimeout(() => {
                console.log('üåô MIDNIGHT RESET TRIGGERED at exactly 00:00');
                performDailyReset();
                scheduleNextMidnightReset();
            }, timeUntilMidnight);
        }

        function performDailyReset() {
            console.log('üîÑ Performing daily reset...');
            const now = new Date();
            console.log(`üïê Reset performed at: ${now.toLocaleString('id-ID')}`);
            
            // Update current date
            currentDate = now;
            lastResetCheck = getTodayKey();
            
            // PERBAIKAN: Update juz rotation untuk hari baru
            updateAllParticipantsJuz();
            
            // Update date display
            updateCurrentDate();
            
            // Re-render participants dengan juz assignments baru
            renderDailyTab();
            
            // Save updated participants
            participants.forEach(participant => {
                saveParticipantToFirebase(participant);
            });
            saveToLocalStorage();
            
            updateFirebaseStatus('connected', 
                `üåÖ Reset berhasil pukul ${now.toLocaleTimeString('id-ID')} | Project: ibkangaji`);
            
            console.log('‚úÖ Daily reset completed successfully');
        }

        function getTodayKey() {
            return new Date().toISOString().split('T')[0];
        }

        // Toggle participant check
        function toggleParticipantCheck(participantId) {
            const today = currentDate.toISOString().split('T')[0];
            const participant = participants.find(p => p.id === participantId);
            
            if (participant) {
                if (participant.dailyProgress[today]) {
                    delete participant.dailyProgress[today];
                } else {
                    participant.dailyProgress[today] = true;
                }
                
                renderDailyTab();
                updateMonthlyRecords();
                
                // Save to Firebase
                saveParticipantToFirebase(participant);
                
                // Save to localStorage as backup
                saveToLocalStorage();
            }
        }

        // PERBAIKAN: Render daily tab dengan nama dan juz yang benar
        function renderDailyTab() {
            const today = currentDate.toISOString().split('T')[0];
            
            // Pastikan ada 30 participants
            if (participants.length !== 30) {
                console.warn(`‚ö†Ô∏è Expected 30 participants, found ${participants.length}. Re-initializing...`);
                initializeParticipants();
            }
            
            const completedToday = participants.filter(p => p.dailyProgress && p.dailyProgress[today]).length;
            
            // Update stats
            document.getElementById('completed-today').textContent = completedToday;
            document.getElementById('khatam-status').textContent = 
                completedToday === 30 ? 'Khatam Hari Ini! üéâ' : `${30 - completedToday} Lagi untuk Khatam`;
            
            // Render participants
            const grid = document.getElementById('participants-grid');
            grid.innerHTML = '';
            
            participants.forEach((participant, index) => {
                const isCompleted = participant.dailyProgress && participant.dailyProgress[today];
                const juzNumber = participant.currentJuz;
                const juzDetail = juzDetails[juzNumber] || { 
                    surah: "Detail tidak tersedia", 
                    pages: "?",
                    description: "Silakan cek Al-Qur'an"
                };
                
                // Debug log untuk nama
                if (index < 5) { // Log first 5 for debugging
                    console.log(`üîç Rendering participant ${participant.id}: Name = "${participant.name}", Juz = ${juzNumber}`);
                }
                
                const card = document.createElement('div');
                card.className = `participant-card ${isCompleted ? 'completed' : ''}`;
                card.onclick = () => toggleParticipantCheck(participant.id);
                
                // Pastikan nama tidak undefined
                const displayName = participant.name || `Peserta ${participant.id}`;
                
                card.innerHTML = `
                    <div class="participant-content">
                        <div class="participant-info">
                            <h3>${displayName}</h3>
                            <p style="font-weight: 600; color: #FF7D29; margin-bottom: 8px;">
                                üìñ Juz ${juzNumber} (Hal. ${juzDetail.pages})
                            </p>
                            <div style="background: #F8F9FA; padding: 8px; border-radius: 6px; margin-bottom: 8px;">
                                <p style="font-size: 0.85rem; color: #374151; font-weight: 500; margin-bottom: 4px;">
                                    ${juzDetail.surah}
                                </p>
                                <p style="font-size: 0.8rem; color: #6B7280; font-style: italic;">
                                    ${juzDetail.description}
                                </p>
                            </div>
                            ${isCompleted ? '<small style="color: #10B981; font-weight: 600;">‚úÖ Sudah Selesai</small>' : '<small style="color: #6B7280;">‚è≥ Belum selesai</small>'}
                        </div>
                        <div class="participant-actions">
                            <span class="icon ${isCompleted ? 'icon-completed' : 'icon-pending'}" style="font-size: 28px;">üìñ</span>
                            <span class="icon ${isCompleted ? 'icon-completed' : 'icon-pending'}" style="font-size: 32px;">‚úÖ</span>
                        </div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
            
            console.log(`üé® Rendered ${participants.length} participants`);
            console.log('üìã First 3 participants:', participants.slice(0, 3).map(p => `${p.name} (ID: ${p.id})`));
        }

        // Switch tabs
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName + '-tab').classList.add('active');
            
            if (tabName === 'monthly') {
                setTimeout(() => {
                    populateMonthSelector();
                    renderMonthlyTab();
                }, 100);
            }
        }

        // Populate month selector
        function populateMonthSelector() {
            const selector = document.getElementById('month-selector');
            if (!selector) {
                console.warn('Month selector not found, will try again later');
                return;
            }
            
            const months = getAvailableMonths();
            const currentMonthKey = currentDate.toISOString().substring(0, 7);
            
            const currentSelection = selector.value;
            
            selector.innerHTML = '';
            
            if (months.length === 0) {
                const fallbackMonth = {
                    key: currentMonthKey,
                    name: currentDate.toLocaleDateString('id-ID', { year: 'numeric', month: 'long' })
                };
                months.push(fallbackMonth);
            }
            
            months.forEach(month => {
                const option = document.createElement('option');
                option.value = month.key;
                option.textContent = month.name;
                
                if ((currentSelection && month.key === currentSelection) || 
                    (!currentSelection && month.key === currentMonthKey)) {
                    option.selected = true;
                }
                
                selector.appendChild(option);
            });
            
            console.log(`üìÖ Generated ${months.length} months for selector:`, 
                       months.map(m => m.name));
        }

        // Get available months
        function getAvailableMonths() {
            const months = [];
            const startDate = new Date('2025-06-01');
            const currentMonth = new Date();
            
            console.log(`üìÖ Generating months from ${startDate.toDateString()} to ${currentMonth.toDateString()}`);
            
            while (startDate <= currentMonth) {
                const monthKey = startDate.toISOString().substring(0, 7);
                const monthName = startDate.toLocaleDateString('id-ID', {
                    year: 'numeric',
                    month: 'long'
                });
                months.push({ key: monthKey, name: monthName });
                startDate.setMonth(startDate.getMonth() + 1);
            }
            
            console.log(`üìÖ Generated ${months.length} months:`, months.map(m => m.name));
            return months.reverse();
        }

        // Update monthly records
        function updateMonthlyRecords() {
            const today = currentDate.toISOString().split('T')[0];
            const monthKey = today.substring(0, 7);
            
            if (!monthlyRecords[monthKey]) {
                monthlyRecords[monthKey] = {
                    khatamCount: 0,
                    participantProgress: {},
                    dailyCompletions: {}
                };
            }
            
            const monthRecord = monthlyRecords[monthKey];
            
            // Update participant progress
            participants.forEach(participant => {
                const monthlyChecks = Object.keys(participant.dailyProgress)
                    .filter(date => date.startsWith(monthKey))
                    .length;
                monthRecord.participantProgress[participant.id] = monthlyChecks;
            });
            
            // Check for khatam
            const todayCompletions = participants.filter(p => p.dailyProgress[today]).length;
            if (todayCompletions === 30) {
                monthRecord.dailyCompletions[today] = true;
            } else {
                delete monthRecord.dailyCompletions[today];
            }
            
            monthRecord.khatamCount = Object.keys(monthRecord.dailyCompletions).length;
            
            // Save to Firebase
            saveMonthlyRecordToFirebase(monthKey, monthRecord);
        }

        // Render monthly tab
        function renderMonthlyTab() {
            const selectedMonth = document.getElementById('month-selector').value;
            const monthRecord = monthlyRecords[selectedMonth] || {
                khatamCount: 0,
                participantProgress: {},
                dailyCompletions: {}
            };
            
            // Update monthly stats
            document.getElementById('monthly-khatam').textContent = monthRecord.khatamCount + 'x';
            
            const totalParticipation = Object.values(monthRecord.participantProgress)
                .reduce((sum, count) => sum + count, 0);
            document.getElementById('monthly-participation').textContent = totalParticipation;
            
            // Render progress grid
            const progressGrid = document.getElementById('progress-grid');
            progressGrid.innerHTML = '';
            
            participants.forEach(participant => {
                const monthlyCount = monthRecord.participantProgress[participant.id] || 0;
                const percentage = Math.round((monthlyCount / 30) * 100);
                
                const progressItem = document.createElement('div');
                progressItem.className = 'progress-item';
                progressItem.innerHTML = `
                    <div class="progress-header">
                        <span class="progress-name">${participant.name}</span>
                        <span class="progress-count">${monthlyCount}/30</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${percentage}%"></div>
                    </div>
                    <div class="progress-percentage">${percentage}%</div>
                `;
                
                progressGrid.appendChild(progressItem);
            });
        }

        // Update monthly view
        function updateMonthlyView() {
            renderMonthlyTab();
        }

        // Local storage functions (as backup)
        function saveToLocalStorage() {
            localStorage.setItem('participants', JSON.stringify(participants));
            localStorage.setItem('monthlyRecords', JSON.stringify(monthlyRecords));
            localStorage.setItem('currentDate', currentDate.toISOString());
        }

        function loadFromLocalStorage() {
            const savedParticipants = localStorage.getItem('participants');
            const savedMonthlyRecords = localStorage.getItem('monthlyRecords');
            const savedDate = localStorage.getItem('currentDate');
            
            if (savedParticipants) {
                const localParticipants = JSON.parse(savedParticipants);
                if (participants.length === 0) {
                    participants = localParticipants;
                    // PERBAIKAN: Paksa update nama dengan nama yang benar
                    participants.forEach((participant, index) => {
                        if (participantNames[index]) {
                            participant.name = participantNames[index];
                        }
                    });
                    // Update juz setelah load dari localStorage
                    updateAllParticipantsJuz();
                    console.log('üì• Participants loaded from localStorage and names updated');
                }
            }
            
            if (savedMonthlyRecords) {
                const localRecords = JSON.parse(savedMonthlyRecords);
                if (Object.keys(monthlyRecords).length === 0) {
                    monthlyRecords = localRecords;
                }
            }
            
            if (savedDate) {
                const savedDateObj = new Date(savedDate);
                const today = new Date();
                if (savedDateObj.toDateString() !== today.toDateString()) {
                    currentDate = today;
                    updateAllParticipantsJuz();
                }
            }
            
            renderDailyTab();
        }

        // Cleanup function
        window.addEventListener('beforeunload', () => {
            if (midnightResetTimeout) {
                clearTimeout(midnightResetTimeout);
            }
            
            unsubscribeListeners.forEach(unsubscribe => {
                if (typeof unsubscribe === 'function') {
                    unsubscribe();
                }
            });
        });

        // Debug functions (available in console)
        window.debugFunctions = {
            testReset: () => {
                console.log('üß™ Manual reset test triggered');
                performDailyReset();
            },
            checkSchedule: () => {
                const now = new Date();
                const tomorrow = new Date(now);
                tomorrow.setDate(tomorrow.getDate() + 1);
                tomorrow.setHours(0, 0, 0, 0);
                const timeUntilMidnight = tomorrow.getTime() - now.getTime();
                
                console.log('üìä Reset Schedule Info:');
                console.log(`Current time: ${now.toLocaleString('id-ID')}`);
                console.log(`Next reset: ${tomorrow.toLocaleString('id-ID')}`);
                console.log(`Time until reset: ${Math.round(timeUntilMidnight / 1000 / 60)} minutes`);
                console.log(`Last reset check: ${lastResetCheck}`);
                console.log(`Current date key: ${getTodayKey()}`);
            },
            forceNewDay: () => {
                console.log('üß™ Force new day simulation');
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                currentDate = tomorrow;
                performDailyReset();
            },
            checkJuzRotation: () => {
                console.log('üìñ Current Juz Assignments:');
                participants.forEach(p => {
                    const expectedJuz = calculateJuzForParticipant(p.id, currentDate);
                    console.log(`${p.name} (ID: ${p.id}): Current Juz ${p.currentJuz} | Expected: ${expectedJuz} | Match: ${p.currentJuz === expectedJuz ? '‚úÖ' : '‚ùå'}`);
                });
                
                const diffTime = currentDate - baseStartDate;
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                console.log(`üìÖ Days since start (${baseStartDate.toDateString()}): ${diffDays}`);
            },
            checkNamesDebug: () => {
                console.log('üîç Debugging nama peserta:');
                console.log('üìù participantNames array:', participantNames);
                console.log('üìù participantNames length:', participantNames.length);
                console.log('üë• Current participants:');
                participants.forEach((p, i) => {
                    console.log(`  ${i + 1}. ID: ${p.id} | Name: "${p.name}" | From array: "${participantNames[i]}" | Juz: ${p.currentJuz}`);
                });
                
                // Check if names are properly assigned
                const missingNames = participants.filter(p => !p.name || p.name.startsWith('Peserta'));
                if (missingNames.length > 0) {
                    console.warn('‚ö†Ô∏è Found participants with missing names:', missingNames);
                } else {
                    console.log('‚úÖ All participants have proper names');
                }
            },
            forceFixNames: () => {
                console.log('üîß Force fixing participant names...');
                console.log('üìù Available names:', participantNames);
                
                // Paksa update semua nama
                participants.forEach((participant, index) => {
                    const oldName = participant.name;
                    participant.name = participantNames[index] || `Peserta ${participant.id}`;
                    console.log(`${participant.id}. "${oldName}" ‚Üí "${participant.name}"`);
                });
                
                // Save ke Firebase dan localStorage
                participants.forEach(participant => {
                    saveParticipantToFirebase(participant);
                });
                saveToLocalStorage();
                
                // Re-render
                renderDailyTab();
                
                console.log('‚úÖ Names fixed and saved to Firebase + localStorage');
            },
            clearLocalStorageOnly: () => {
                console.log('üóëÔ∏è Clearing localStorage only...');
                localStorage.clear();
                
                // Reinitialize dengan nama yang benar
                participants = [];
                initializeParticipants();
                renderDailyTab();
                
                console.log('‚úÖ localStorage cleared, app reinitialized with correct names');
                console.log('üìã Names should now show:', participants.slice(0, 5).map(p => p.name));
            },
        };

        // Make debug functions available
        console.log('üîß Debug functions available:');
        console.log('- debugFunctions.testReset() - Test reset manually');
        console.log('- debugFunctions.checkSchedule() - Check reset schedule');
        console.log('- debugFunctions.forceNewDay() - Simulate new day');
        console.log('- debugFunctions.checkJuzRotation() - Check juz assignments');
        console.log('- debugFunctions.updateJuzNow() - Update juz immediately');
    </script>
</body>
</html>
